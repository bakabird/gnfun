import{FreeList}from"./Collection/FreeList";import CountdownRunner from"./Runner/CountdownRunner";import RoundRunner from"./Runner/RoundRunner";export default{FreeList:FreeList,RoundRunner:RoundRunner,CountdownRunner:CountdownRunner};function isNull(t){return null==t}function notNull(t){return null!=t}class FreeListIterator{constructor(t){this._list=t,this._next=0}hasNext(){return this._next<this._list.size}peekNext(){return this._list.at(this._next)}getNext(){return this._list.at(this._next++)}moveNext(){++this._next}get nextIndex(){return this._next}get _nextIndex(){return this._next}set _nextIndex(t){this._next=t}}class FreeList{constructor(t){this._ary=t||[],this._it=new FreeListIterator(this),this._tempIts=null,this._poolIts=null}get it(){return this._it._nextIndex=0,this._it}beginVisit(){let t;return this._tempIts||(this._tempIts=[]),(t=this._poolIts&&0<this._poolIts.length?this._poolIts.pop():new FreeListIterator(this))._nextIndex=0,this._tempIts.push(t),t}endVisit(t){var e=this._tempIts.indexOf(t);-1!==e&&(this._tempIts.splice(e,1),this._poolIts||(this._poolIts=[]),this._poolIts.push(t))}get size(){return this._ary.length}get length(){return this._ary.length}at(t){return this._ary[t]}get front(){return this._ary[0]}get back(){return this._ary[this._ary.length-1]}push(t){return this._adjustItByAdd(this._ary.length,1),this._ary.push(t)}pop(){if(0<this._ary.length)return this._adjustItByRemove(this._ary.length-1,1),this._ary.pop()}unshift(t){return this._adjustItByAdd(0,1),this._ary.unshift(t)}shift(){if(0<this._ary.length)return this._adjustItByRemove(0,1),this._ary.shift()}indexOf(t,e){return this._ary.indexOf(t,e)}indexIf(e,s){for(let t=s=s||0;t<this._ary.length;++t)if(e(this._ary[t]))return t;return-1}findFirstIf(e){for(let t=0;t<this._ary.length;++t)if(e(this._ary[t]))return this._ary[t]}remove(t){return this.removeAt(this.indexOf(t))}unsafeReverse(){this._ary.reverse()}removeAt(t){var e;if(0<=t&&t<this._ary.length)return this._adjustItByRemove(t,1),e=this._ary[t],this._ary.splice(t,1),e}splice(t,e){if(0<=t&&t<this._ary.length)return e=Math.min(e,this._ary.length-t),this._adjustItByRemove(t,e),this._ary.splice(t,e)}removeFirstIf(e,s){for(let t=s=s||0;t<this._ary.length;++t)if(e(this._ary[t]))return this.removeAt(t)}removeIf(s){var r=this._ary;if(0!=r.length){let t=0,e=0;for(;t<r.length;t++)s(r[t])||(r[e++]=r[t]);e<t&&(this._adjustItByRemove(e,t-e),r.splice(e,t-e))}}insert(t,e){return e<0||e>=this._ary.length?this.push(t):(this._adjustItByAdd(e,1),this._ary.splice(e,0,t),this._ary.length)}foreach_unsafe(e,s){for(let t=s=s||0;t<this._ary.length;++t)if(!1===e(this._ary[t]))return!1;return!0}foreach(t,e){e=e||0;for(var s=this.it;s.hasNext();)if(s.nextIndex<e)s.moveNext();else if(!1===t(s.getNext()))return!1;return!0}foreach_safe(t,e){let s=!0;e=e||0;for(var r=this.beginVisit();r.hasNext();)if(r.nextIndex<e)r.moveNext();else if(!1===t(r.getNext())){s=!1;break}return this.endVisit(r),s}map(e){let s=[],r=0;return this.foreach_unsafe(t=>(s.push(e(t,r++)),!0)),s}clear(){if(this._it._nextIndex=0,this._ary.length=0,this._tempIts)for(let t=0;t<this._tempIts.length;++t)this._tempIts[t]._nextIndex=0}clone(t,e){return this.copyTo(new FreeList,t,e)}copyTo(e,s,t){s=Math.max(0,s||0),null==t&&(t=this._ary.length);var r=Math.min(s+t,this._ary.length);for(let t=s;t<r;++t)e.push(this._ary[t]);return e}_adjustItByAdd(e,s){if(this._it._nextIndex>e&&(this._it._nextIndex+=s),this._tempIts)for(let t=0;t<this._tempIts.length;++t){var r=this._tempIts[t];r._nextIndex>e&&(r._nextIndex+=s)}}_adjustItByRemove(e,s){if(this._it._nextIndex>e&&(this._it._nextIndex=Math.max(e+s,this._it._nextIndex)-s),this._tempIts)for(let t=0;t<this._tempIts.length;++t){var r=this._tempIts[t];r._nextIndex>e&&(r._nextIndex=Math.max(e+s,r._nextIndex)-s)}}report(){console.log("reprot >"),console.log(this._ary),console.log("reprot <")}}export default class CountdownRunner{get bindedCountdown(){return this.countdown.bind(this)}constructor(t,e){this._countdown=t,this._run=e}countdown(){var t;--this._countdown,this._countdown<=0&&(null!=(t=this._run)&&t.call(this),this._run=void 0)}}import{FreeList}from"../Collection/FreeList";export default class RoundRunner{get over(){return 0==this._steps.length}constructor(){this._steps=new FreeList}append(t){this._steps.push(t)}reverse(){this._steps.unsafeReverse()}runRound(t){let e=0,s;this._steps.foreach_safe(()=>(e++,(s=this._steps.shift())(),e<t))}runAll(){for(;0!=this._steps.length;)this._steps.shift()()}produceExecuteBody(t,e,s){const r=()=>{0<t?this.runRound(t):this.runAll(),this.over?s(this):e(r)};return r}}export{notNull,isNull,FreeListIterator,FreeList};