class FreeListIterator{constructor(t){this._list=t,this._next=0}hasNext(){return this._next<this._list.size}peekNext(){return this._list.at(this._next)}getNext(){return this._list.at(this._next++)}moveNext(){++this._next}get nextIndex(){return this._next}get _nextIndex(){return this._next}set _nextIndex(t){this._next=t}}class FreeList{constructor(t){this._ary=t||[],this._it=new FreeListIterator(this),this._tempIts=null,this._poolIts=null}get it(){return this._it._nextIndex=0,this._it}beginVisit(){let t;return this._tempIts||(this._tempIts=[]),(t=this._poolIts&&0<this._poolIts.length?this._poolIts.pop():new FreeListIterator(this))._nextIndex=0,this._tempIts.push(t),t}endVisit(t){var e=this._tempIts.indexOf(t);-1!==e&&(this._tempIts.splice(e,1),this._poolIts||(this._poolIts=[]),this._poolIts.push(t))}get size(){return this._ary.length}get length(){return this._ary.length}at(t){return this._ary[t]}get front(){return this._ary[0]}get back(){return this._ary[this._ary.length-1]}push(t){return this._adjustItByAdd(this._ary.length,1),this._ary.push(t)}pop(){if(0<this._ary.length)return this._adjustItByRemove(this._ary.length-1,1),this._ary.pop()}unshift(t){return this._adjustItByAdd(0,1),this._ary.unshift(t)}shift(){if(0<this._ary.length)return this._adjustItByRemove(0,1),this._ary.shift()}indexOf(t,e){return this._ary.indexOf(t,e)}indexIf(e,r){for(let t=r=r||0;t<this._ary.length;++t)if(e(this._ary[t]))return t;return-1}findFirstIf(e){for(let t=0;t<this._ary.length;++t)if(e(this._ary[t]))return this._ary[t]}remove(t){return this.removeAt(this.indexOf(t))}unsafeReverse(){this._ary.reverse()}removeAt(t){var e;if(0<=t&&t<this._ary.length)return this._adjustItByRemove(t,1),e=this._ary[t],this._ary.splice(t,1),e}splice(t,e){if(0<=t&&t<this._ary.length)return e=Math.min(e,this._ary.length-t),this._adjustItByRemove(t,e),this._ary.splice(t,e)}removeFirstIf(e,r){for(let t=r=r||0;t<this._ary.length;++t)if(e(this._ary[t]))return this.removeAt(t)}removeIf(r){var n=this._ary;if(0!=n.length){let t=0,e=0;for(;t<n.length;t++)r(n[t])||(n[e++]=n[t]);e<t&&(this._adjustItByRemove(e,t-e),n.splice(e,t-e))}}insert(t,e){return e<0||e>=this._ary.length?this.push(t):(this._adjustItByAdd(e,1),this._ary.splice(e,0,t),this._ary.length)}foreach_unsafe(e,r){for(let t=r=r||0;t<this._ary.length;++t)if(!1===e(this._ary[t]))return!1;return!0}foreach(t,e){e=e||0;for(var r=this.it;r.hasNext();)if(r.nextIndex<e)r.moveNext();else if(!1===t(r.getNext()))return!1;return!0}foreach_safe(t,e){let r=!0;e=e||0;for(var n=this.beginVisit();n.hasNext();)if(n.nextIndex<e)n.moveNext();else if(!1===t(n.getNext())){r=!1;break}return this.endVisit(n),r}map(e){let r=[],n=0;return this.foreach_unsafe(t=>(r.push(e(t,n++)),!0)),r}clear(){if(this._it._nextIndex=0,this._ary.length=0,this._tempIts)for(let t=0;t<this._tempIts.length;++t)this._tempIts[t]._nextIndex=0}clone(t,e){return this.copyTo(new FreeList,t,e)}copyTo(e,r,t){r=Math.max(0,r||0),null==t&&(t=this._ary.length);var n=Math.min(r+t,this._ary.length);for(let t=r;t<n;++t)e.push(this._ary[t]);return e}_adjustItByAdd(e,r){if(this._it._nextIndex>e&&(this._it._nextIndex+=r),this._tempIts)for(let t=0;t<this._tempIts.length;++t){var n=this._tempIts[t];n._nextIndex>e&&(n._nextIndex+=r)}}_adjustItByRemove(e,r){if(this._it._nextIndex>e&&(this._it._nextIndex=Math.max(e+r,this._it._nextIndex)-r),this._tempIts)for(let t=0;t<this._tempIts.length;++t){var n=this._tempIts[t];n._nextIndex>e&&(n._nextIndex=Math.max(e+r,n._nextIndex)-r)}}report(){console.log("reprot >"),console.log(this._ary),console.log("reprot <")}}class PoolModule{constructor(t,e){this._ctor=t,this._dtor=e,this._pool=[]}alloc(){return 0<this._pool.length?this._pool.shift():this._ctor()}free(t){var e;null!=(e=this._dtor)&&e.call(this,t),this._pool.push(t)}}const easyEncodeDist={a:"l",b:"k",c:"j",d:"i",e:"h",f:"g",g:"f",h:"e",i:"d",j:"c",k:"b",l:"a",m:"t",n:"s",o:"r",p:"q",q:"p",r:"o",s:"n",t:"m",u:"z",v:"y",w:"x",x:"w",y:"v",z:"u",A:"L",B:"K",C:"J",D:"I",E:"H",F:"G",G:"F",H:"E",I:"D",J:"C",K:"B",L:"A",M:"T",N:"S",O:"R",P:"Q",Q:"P",R:"O",S:"N",T:"M",U:"Z",V:"Y",W:"X",X:"W",Y:"V",Z:"U"};function easyEncode(e){let r="";for(let t=0;t<e.length;t++){var n=e[t];r+=easyEncodeDist[n]||n}return r}function className(t){return t.constructor.name}function deepClone(t){if(null==t||t)return t;var e,r,n,s=Object.prototype.toString.call(t);if("[object Array]"===s)for(e=[],r=0,n=t.length;r<n;r++)e.push(deepClone(t[r]));else{if("[object Object]"!==s)return t;for(r in e={},t)e[r]=deepClone(t[r])}return e}function emptyString(t){return!(null!=t&&!t)||""===t}function remap(t,e,r,n,s){return(t-e)/(r-e)*(s-n)+n}function objectValues(e){var t=Object.prototype.toString.call(e);if(null==e)throw new TypeError("Cannot convert undefined or null to object");if(~["[object String]","[object Object]","[object Array]","[object Function]"].indexOf(t)){if(Object.keys)return Object.keys(e).map(function(t){return e[t]});var r,n=[];for(r in e)e.hasOwnProperty(r)&&n.push(e[r]);return n}return[]}function getEnumName(e,r){return Object.keys(e).find(t=>e[t]==r)}function enumValues(t,e){return"string"==e?objectValues(t):objectValues(t).filter(t=>"number"==typeof t)}function enumKeys(e,t){return"string"==t?Object.keys(e):Object.keys(e).filter(t=>"number"==typeof e[t])}function isNull(t){return null==t}function notNull(t){return null!=t}function removeNullKeys(t){var e,r={};for(const n in t)t.hasOwnProperty(n)&&notNull(e=t[n])&&(r[n]=e);return r}function toNumber(t,e){return isNull(t)?isNull(e)?NaN:e:Number(t)}function _randomWithSeed(t){return t=.001*Math.pow(t,2),.9999*toNumber("0."+Math.sin(t).toString().slice(6))}function random(t,e,r){return t+(r?_randomWithSeed(r):Math.random())*(e-t)}function randomInt(t,e,r){return Math.floor(random(t,e,r))}function randomIntArr(t,e){return randomInt(t[0],t[1],e)}function pick(t,e){return t[randomInt(0,t.length,e)]}function pickWeights(e,t){let r=0;for(var n of e)r+=n;var s=randomInt(0,r,t);let i=0,o=-1;for(let t=0;t<e.length;t++){var h=e[t];if(s<=(i+=h)){o=t;break}}return o}function pickWeightsBy(e,t){var r,n=t&&t.seed,s=t&&t.fieldName;if(!e||0===e.length)return-1;if(isNull(s))return pickWeights(e,n);let i=0;for(r of e){let t=r[s];isNull(t)&&(t=1),i+=t}var o=randomInt(0,i,n);let h=0,a=e.length-1;for(let t=0;t<e.length;t++){var u=e[t];if(o<=(h+=u[s])){a=t;break}}return a}function arrayRemove(t,e){e=t.indexOf(e);return-1<e&&t.splice(e,1),t}function arrayRemoveFirst(e,r){for(let t=0;t<e.length;t++){var n=e[t];if(r(n))return e.splice(t,1),n}return null}function arrayFindIndexAll(t,n){return t.reduce((t,e,r)=>(n(e)&&t.push(r),t),[])}function arrayRemoveAll(e,t){const r=[];return arrayFindIndexAll(e,t).reverse().forEach(t=>{r.push(e[t]),e.splice(t,1)}),r}function arrayIncludes(t,e){return-1<t.indexOf(e)}class Shake2DModule{constructor(t,e,r,n,s,i,o){this.magnitude=t,this.duration=e,this.speed=r,this.shaketype=n,this.RandomRange=s,this.onGetOriginal=i,this.onShake=o,this._time=0,this._ratio=0,this._random1=random(-this.RandomRange,this.RandomRange),this._random2=random(-this.RandomRange,this.RandomRange)}get ratio(){return this._ratio}set ratio(t){var e=t*this.duration;e>this.duration||e<this._time||(this._upt(e-this._time),this._time=e,this._ratio=t)}_upt(t){var e,r,n,s=this._random1,i=this._random2,o=this.onGetOriginal(),h=this.magnitude,t=(this._time+=t,this._time/this.duration),a=t*this.speed;switch(this.shaketype){case"smooth":e=Math.sin(s+a),r=Math.cos(i+a);break;case"smoothHalfCircle":e=Math.sin(s+a*Math.PI),r=Math.cos(i+a*Math.PI);break;case"smoothCircle":e=Math.sin(s+a*Math.PI*2),r=Math.cos(i+a*Math.PI*2);break;case"perlinNoise":e=Math.sin(s+a),r=Math.cos(i+a);break;default:e=random(-1,1),r=random(-1,1)}t<.5?((n={x:e*h,y:r*h}).x+=o.x,n.y+=o.y,this.onShake(n)):((h={x:e*(n=h*(2*(1-t))),y:r*n}).x+=o.x,h.y+=o.y,this.onShake(h))}}class CountdownRunner{get bindedCountdown(){return this.countdown.bind(this)}constructor(t,e){this._countdown=t,this._run=e}countdown(){var t;--this._countdown,this._countdown<=0&&(null!=(t=this._run)&&t.call(this),this._run=void 0)}}class RoundRunner{get over(){return 0==this._steps.length}constructor(){this._steps=new FreeList}append(t){this._steps.push(t)}reverse(){this._steps.unsafeReverse()}runRound(t){let e=0,r;this._steps.foreach_safe(()=>(e++,(r=this._steps.shift())(),e<t))}runAll(){for(;0!=this._steps.length;)this._steps.shift()()}produceExecuteBody(t,e,r){const n=()=>{0<t?this.runRound(t):this.runAll(),this.over?r(this):e(n)};return n}}export{CountdownRunner,FreeList,PoolModule,RoundRunner,Shake2DModule,arrayFindIndexAll,arrayIncludes,arrayRemove,arrayRemoveAll,arrayRemoveFirst,className,deepClone,easyEncode,emptyString,enumKeys,enumValues,getEnumName,isNull,notNull,objectValues,pick,pickWeights,pickWeightsBy,random,randomInt,randomIntArr,remap,removeNullKeys,toNumber};